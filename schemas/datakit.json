{
  "fields": [
    {
      "protocols": {
        "default": [
          "grpc",
          "grpcs",
          "http",
          "https"
        ],
        "elements": {
          "type": "string",
          "one_of": [
            "grpc",
            "grpcs",
            "http",
            "https"
          ]
        },
        "description": "A set of strings representing HTTP protocols.",
        "required": true,
        "type": "set"
      }
    },
    {
      "config": {
        "type": "record",
        "required": true,
        "fields": [
          {
            "nodes": {
              "len_min": 1,
              "type": "array",
              "required": true,
              "elements": {
                "subschema_override_parent": true,
                "type": "record",
                "description": "datakit nodes",
                "subschema_definitions": {
                  "exit": {
                    "type": "record",
                    "description": "exit node",
                    "entity_checks": [
                      {
                        "mutually_exclusive": [
                          "input",
                          "inputs"
                        ]
                      },
                      {
                        "mutually_exclusive": [
                          "output",
                          "outputs"
                        ]
                      }
                    ],
                    "fields": [
                      {
                        "status": {
                          "between": [
                            200,
                            599
                          ],
                          "default": 200,
                          "description": "HTTP status code",
                          "required": false,
                          "type": "integer"
                        }
                      },
                      {
                        "warn_headers_sent": {
                          "required": false,
                          "type": "boolean"
                        }
                      },
                      {
                        "inputs": {
                          "description": "inputs mapping for the \"exit\" node",
                          "keys": {
                            "len_min": 1,
                            "type": "string"
                          },
                          "type": "record",
                          "values": {
                            "len_min": 1,
                            "match_any": {
                              "err": "must be one of NODE_NAME or NODE_NAME.FIELD",
                              "patterns": [
                                "^[A-Za-z_][A-Za-z0-9_-]*$",
                                "^[A-Za-z_][A-Za-z0-9_-]*%..+$"
                              ]
                            },
                            "type": "string"
                          },
                          "required": false,
                          "fields": [
                            {
                              "body": {
                                "type": "string",
                                "required": false,
                                "description": "HTTP response body"
                              }
                            },
                            {
                              "headers": {
                                "type": "string",
                                "required": false,
                                "description": "HTTP response headers"
                              }
                            }
                          ]
                        }
                      },
                      {
                        "input": {
                          "len_min": 1,
                          "description": "input mapping for the \"exit\" node",
                          "match_any": {
                            "err": "must be one of NODE_NAME or NODE_NAME.FIELD",
                            "patterns": [
                              "^[A-Za-z_][A-Za-z0-9_-]*$",
                              "^[A-Za-z_][A-Za-z0-9_-]*%..+$"
                            ]
                          },
                          "required": false,
                          "type": "string"
                        }
                      }
                    ]
                  },
                  "jq": {
                    "type": "record",
                    "description": "jq node",
                    "entity_checks": [
                      {
                        "mutually_exclusive": [
                          "input",
                          "inputs"
                        ]
                      },
                      {
                        "mutually_exclusive": [
                          "output",
                          "outputs"
                        ]
                      }
                    ],
                    "fields": [
                      {
                        "jq": {
                          "len_min": 1,
                          "required": true,
                          "type": "string"
                        }
                      },
                      {
                        "inputs": {
                          "description": "inputs mapping for the \"jq\" node",
                          "required": false,
                          "values": {
                            "type": "string"
                          },
                          "keys": {
                            "type": "string"
                          },
                          "type": "map"
                        }
                      },
                      {
                        "input": {
                          "len_min": 1,
                          "description": "input mapping for the \"jq\" node",
                          "match_any": {
                            "err": "must be one of NODE_NAME or NODE_NAME.FIELD",
                            "patterns": [
                              "^[A-Za-z_][A-Za-z0-9_-]*$",
                              "^[A-Za-z_][A-Za-z0-9_-]*%..+$"
                            ]
                          },
                          "required": false,
                          "type": "string"
                        }
                      },
                      {
                        "output": {
                          "len_min": 1,
                          "type": "string",
                          "match_any": {
                            "err": "must be one of NODE_NAME or NODE_NAME.FIELD",
                            "patterns": [
                              "^[A-Za-z_][A-Za-z0-9_-]*$",
                              "^[A-Za-z_][A-Za-z0-9_-]*%..+$"
                            ]
                          },
                          "required": false,
                          "description": "output mapping for the \"jq\" node"
                        }
                      }
                    ]
                  },
                  "static": {
                    "type": "record",
                    "description": "static node",
                    "entity_checks": [
                      {
                        "mutually_exclusive": [
                          "input",
                          "inputs"
                        ]
                      },
                      {
                        "mutually_exclusive": [
                          "output",
                          "outputs"
                        ]
                      }
                    ],
                    "fields": [
                      {
                        "values": {
                          "len_min": 1,
                          "required": true,
                          "values": {
                            "json_schema": {
                              "inline": {
                                "type": [
                                  "array",
                                  "boolean",
                                  "null",
                                  "number",
                                  "object",
                                  "string"
                                ]
                              }
                            },
                            "type": "json",
                            "required": false,
                            "description": "Any JSON-serializable type"
                          },
                          "keys": {
                            "len_min": 1,
                            "type": "string"
                          },
                          "type": "map"
                        }
                      },
                      {
                        "outputs": {
                          "type": "map",
                          "keys": {
                            "type": "string"
                          },
                          "values": {
                            "type": "string"
                          },
                          "required": false,
                          "description": "outputs mapping for the \"static\" node"
                        }
                      }
                    ]
                  },
                  "property": {
                    "type": "record",
                    "description": "property node",
                    "entity_checks": [
                      {
                        "mutually_exclusive": [
                          "input",
                          "inputs"
                        ]
                      },
                      {
                        "mutually_exclusive": [
                          "output",
                          "outputs"
                        ]
                      }
                    ],
                    "fields": [
                      {
                        "content_type": {
                          "type": "string",
                          "one_of": [
                            "application/json",
                            "text/plain"
                          ],
                          "required": false,
                          "description": "HTTP content type/mime type specifier"
                        }
                      },
                      {
                        "property": {
                          "len_min": 1,
                          "required": true,
                          "type": "string"
                        }
                      },
                      {
                        "input": {
                          "len_min": 1,
                          "description": "input mapping for the \"property\" node",
                          "match_any": {
                            "err": "must be one of NODE_NAME or NODE_NAME.FIELD",
                            "patterns": [
                              "^[A-Za-z_][A-Za-z0-9_-]*$",
                              "^[A-Za-z_][A-Za-z0-9_-]*%..+$"
                            ]
                          },
                          "required": false,
                          "type": "string"
                        }
                      },
                      {
                        "output": {
                          "len_min": 1,
                          "type": "string",
                          "match_any": {
                            "err": "must be one of NODE_NAME or NODE_NAME.FIELD",
                            "patterns": [
                              "^[A-Za-z_][A-Za-z0-9_-]*$",
                              "^[A-Za-z_][A-Za-z0-9_-]*%..+$"
                            ]
                          },
                          "required": false,
                          "description": "output mapping for the \"property\" node"
                        }
                      }
                    ]
                  },
                  "call": {
                    "type": "record",
                    "description": "call node",
                    "entity_checks": [
                      {
                        "mutually_exclusive": [
                          "input",
                          "inputs"
                        ]
                      },
                      {
                        "mutually_exclusive": [
                          "output",
                          "outputs"
                        ]
                      }
                    ],
                    "fields": [
                      {
                        "method": {
                          "match": "^%u+$",
                          "default": "GET",
                          "description": "A string representing an HTTP method, such as GET, POST, PUT, or DELETE. The string must contain only uppercase letters.",
                          "type": "string"
                        }
                      },
                      {
                        "ssl_server_name": {
                          "type": "string",
                          "description": "A string representing an SNI (server name indication) value for TLS."
                        }
                      },
                      {
                        "timeout": {
                          "between": [
                            0,
                            2147483646
                          ],
                          "type": "integer",
                          "description": "An integer representing a timeout in milliseconds. Must be between 0 and 2^31-2."
                        }
                      },
                      {
                        "url": {
                          "description": "A string representing a URL, such as https://example.com/path/to/resource?q=search.",
                          "required": true,
                          "type": "string"
                        }
                      },
                      {
                        "inputs": {
                          "description": "inputs mapping for the \"call\" node",
                          "keys": {
                            "len_min": 1,
                            "type": "string"
                          },
                          "type": "record",
                          "values": {
                            "len_min": 1,
                            "match_any": {
                              "err": "must be one of NODE_NAME or NODE_NAME.FIELD",
                              "patterns": [
                                "^[A-Za-z_][A-Za-z0-9_-]*$",
                                "^[A-Za-z_][A-Za-z0-9_-]*%..+$"
                              ]
                            },
                            "type": "string"
                          },
                          "required": false,
                          "fields": [
                            {
                              "body": {
                                "type": "string",
                                "required": false,
                                "description": "HTTP request body"
                              }
                            },
                            {
                              "headers": {
                                "type": "string",
                                "required": false,
                                "description": "HTTP request headers"
                              }
                            },
                            {
                              "query": {
                                "type": "string",
                                "required": false,
                                "description": "HTTP request query"
                              }
                            }
                          ]
                        }
                      },
                      {
                        "input": {
                          "len_min": 1,
                          "description": "input mapping for the \"call\" node",
                          "match_any": {
                            "err": "must be one of NODE_NAME or NODE_NAME.FIELD",
                            "patterns": [
                              "^[A-Za-z_][A-Za-z0-9_-]*$",
                              "^[A-Za-z_][A-Za-z0-9_-]*%..+$"
                            ]
                          },
                          "required": false,
                          "type": "string"
                        }
                      },
                      {
                        "outputs": {
                          "type": "record",
                          "required": false,
                          "fields": [
                            {
                              "body": {
                                "type": "string",
                                "required": false,
                                "description": "HTTP response body"
                              }
                            },
                            {
                              "headers": {
                                "type": "string",
                                "required": false,
                                "description": "HTTP response headers"
                              }
                            },
                            {
                              "status": {
                                "type": "string",
                                "required": false,
                                "description": "HTTP response status code"
                              }
                            }
                          ],
                          "values": {
                            "len_min": 1,
                            "match_any": {
                              "err": "must be one of NODE_NAME or NODE_NAME.FIELD",
                              "patterns": [
                                "^[A-Za-z_][A-Za-z0-9_-]*$",
                                "^[A-Za-z_][A-Za-z0-9_-]*%..+$"
                              ]
                            },
                            "type": "string"
                          },
                          "keys": {
                            "len_min": 1,
                            "type": "string"
                          },
                          "description": "outputs mapping for the \"call\" node"
                        }
                      },
                      {
                        "output": {
                          "len_min": 1,
                          "type": "string",
                          "match_any": {
                            "err": "must be one of NODE_NAME or NODE_NAME.FIELD",
                            "patterns": [
                              "^[A-Za-z_][A-Za-z0-9_-]*$",
                              "^[A-Za-z_][A-Za-z0-9_-]*%..+$"
                            ]
                          },
                          "required": false,
                          "description": "output mapping for the \"call\" node"
                        }
                      }
                    ]
                  }
                },
                "subschema_error": "unknown node type: %q, expected one of: call, exit, jq, property, static",
                "subschema_key": "type",
                "fields": [
                  {
                    "name": {
                      "len_min": 1,
                      "not_one_of": [
                        "request",
                        "response",
                        "service_request",
                        "service_response"
                      ],
                      "type": "string",
                      "match_none": [
                        {
                          "err": "reserved node name",
                          "pattern": "^_$"
                        },
                        {
                          "err": "reserved node name",
                          "pattern": "^context$"
                        },
                        {
                          "err": "reserved node name",
                          "pattern": "^ctx$"
                        },
                        {
                          "err": "reserved node name",
                          "pattern": "^globals$"
                        },
                        {
                          "err": "reserved node name",
                          "pattern": "^kong$"
                        },
                        {
                          "err": "reserved node name",
                          "pattern": "^ngx$"
                        },
                        {
                          "err": "reserved node name",
                          "pattern": "^node$"
                        },
                        {
                          "err": "reserved node name",
                          "pattern": "^plan$"
                        },
                        {
                          "err": "reserved node name",
                          "pattern": "^plugin$"
                        },
                        {
                          "err": "reserved node name",
                          "pattern": "^property$"
                        },
                        {
                          "err": "reserved node name",
                          "pattern": "^self$"
                        },
                        {
                          "err": "reserved node name",
                          "pattern": "^static$"
                        },
                        {
                          "err": "reserved node name",
                          "pattern": "^vars$"
                        }
                      ],
                      "match_all": [
                        {
                          "err": "must be a valid identifier",
                          "pattern": "^[A-Za-z_][A-Za-z0-9_-]*$"
                        }
                      ],
                      "required": true,
                      "description": "node identifier, must be unique"
                    }
                  },
                  {
                    "type": {
                      "one_of": [
                        "call",
                        "exit",
                        "jq",
                        "property",
                        "static"
                      ],
                      "required": true,
                      "type": "string"
                    }
                  }
                ]
              }
            }
          },
          {
            "debug": {
              "type": "boolean",
              "required": false,
              "default": false
            }
          }
        ]
      }
    }
  ],
  "entity_checks": [
    {
      "custom_entity_check": {
        "field_sources": [
          "config"
        ],
        "pass_errors_to_checker": true
      }
    }
  ]
}